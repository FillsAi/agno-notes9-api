# 2. AWS Architecture Diagram ğŸ—ï¸

## 2.1 Your Complete AI Agent API Infrastructure

```
                                    ğŸŒ Internet
                                         |
                                         |
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚      Application Load Balancer      â”‚
                     â”‚     (agent-api-prd-api-lb)          â”‚
                     â”‚    Port 80/443 â†’ Port 8000          â”‚
                     â”‚   DNS: agent-api-prd-api-lb-        â”‚
                     â”‚    1166124937.us-east-1.elb.aws...  â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       |
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚    Target Group  â”‚                  â”‚
                    â”‚  (agent-api-prd-api-tg)             â”‚
                    â”‚    Health Check: /v1/health         â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       |
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚          ECS Cluster                â”‚
                     â”‚     (agent-api-prd-cluster)         â”‚
                     â”‚                                     â”‚
                     â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                     â”‚   â”‚     ECS Service             â”‚   â”‚
                     â”‚   â”‚ (agent-api-prd-api-service) â”‚   â”‚
                     â”‚   â”‚                             â”‚   â”‚
                     â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
                     â”‚   â”‚  â”‚   ECS Task          â”‚    â”‚   â”‚
                     â”‚   â”‚  â”‚ (FastAPI Container) â”‚    â”‚   â”‚
                     â”‚   â”‚  â”‚                     â”‚    â”‚   â”‚
                     â”‚   â”‚  â”‚ CPU: 1024 (1 vCPU)  â”‚    â”‚   â”‚
                     â”‚   â”‚  â”‚ Memory: 2048 MB     â”‚    â”‚   â”‚
                     â”‚   â”‚  â”‚ Workers: 2          â”‚    â”‚   â”‚
                     â”‚   â”‚  â”‚ Port: 8000          â”‚    â”‚   â”‚
                     â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
                     â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       |
                                       | Database Connection
                                       | Port 5432
                                       |
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚         RDS Database                â”‚
                     â”‚     (agent-api-prd-db)              â”‚
                     â”‚                                     â”‚
                     â”‚  Engine: PostgreSQL 17.2            â”‚
                     â”‚  Instance: db.t4g.small             â”‚
                     â”‚  Storage: 64GB                      â”‚
                     â”‚  Database: ai                       â”‚
                     â”‚  Port: 5432                         â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Security Groups                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     agent-api-prd-lb-sg:                                        â”‚
â”‚     - Allows: Internet â†’ Load Balancer (Port 80/443)            â”‚
â”‚                                                                 â”‚
â”‚      agent-api-prd-sg:                                          â”‚
â”‚       - Allows: Load Balancer â†’ App (Port 8000)                 â”‚
â”‚                                                                 â”‚
â”‚      agent-api-prd-db-sg:                                       â”‚
â”‚       - Allows: App â†’ Database (Port 5432)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       Secrets Manager                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     agent-api-prd-secrets:                                      â”‚
â”‚      - SECRET_KEY, APP_PASSWORD, OPENAI_API_KEY                 â”‚
â”‚                                                                 â”‚
â”‚     agent-api-prd-db-secrets:                                   â”‚
â”‚      - MASTER_USERNAME: agno                                    â”‚
â”‚       - MASTER_USER_PASSWORD: agno9999!!                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 2.2 Network Details

### 2.2.1 Subnets Used:
- `subnet-0737407494d0bece0` (us-east-1a)
- `subnet-0cf76bae1f89ad68e` (us-east-1b)

### 2.2.2 VPC:
- `vpc-0c47fe79175922265`

### 2.2.3 Region:
- `us-east-1` (N. Virginia)

## 2.3 IAM Roles Created:

### 2.3.1 Task Execution Role:
- `agent-api-prd-api-td-execution-role`
- Policies:
  - AmazonECSTaskExecutionRolePolicy
  - CloudWatchFullAccess
  - Custom ECS Secret Policy

### 2.3.2 Task Role:
- `agent-api-prd-api-td-task-role`
- Policies:
  - AmazonECSTaskExecutionRolePolicy
  - CloudWatchFullAccess
  - SecretsManagerReadWrite
  - AmazonS3FullAccess
  - Custom Bedrock Access Policy

## 2.4 Request Flow:

```
1. ğŸŒ User Request â†’ Load Balancer (HTTP/HTTPS)
2. âš–ï¸ Load Balancer â†’ Target Group â†’ ECS Task (Port 8000)
3. ğŸ³ ECS Task â†’ Processes Request (FastAPI + 2 Workers)
4. ğŸ—ƒï¸ ECS Task â†’ Database Query (PostgreSQL)
5. ğŸ“¤ Database â†’ ECS Task â†’ Load Balancer â†’ User
```

## 2.5 Cost Per Hour:

```
ğŸ’° RDS (db.t4g.small):      $0.034/hour  (~$25/month)
ğŸ’° ECS Fargate (1vCPU,2GB): $0.020/hour  (~$15/month)
ğŸ’° Load Balancer:           $0.022/hour  (~$16/month)
ğŸ’° Secrets Manager:         $0.040/month (~$1/month)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ’° Total:                   $0.076/hour  (~$57/month)
```

Your infrastructure is now live and running! ğŸš€ 